<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Image to Bytes</title>
	</head>

	<body>
		<h2>Upload Image</h2>
		<caption>Image: </caption>
		<input type="file" id="fileInput" accept="image/*">
		<br>
		<caption>JWT Token: </caption>
		<input type="text" id="jwt-token">
		<h3>Bytes Output:</h3>
		<textarea id="outputBytes" rows="10" cols="80" readonly></textarea>

		<script>
		document.getElementById('fileInput').addEventListener('change', function (event) {
			const file = event.target.files[0];
			let format = file.type;
			if (file.type === "image/png" || file.type === "image/jpeg") {
				console.log("Image format");
			} else {
				console.log("Image format: Unknown");
				alert("Invalid file");
				exit(1);
			}

			const token = document.getElementById('jwt-token').value;

			const reader = new FileReader();

			reader.onloadend = function () {
				const arrayBuffer = reader.result;
				const byteArray = new Uint8Array(arrayBuffer);
				const byteValues = Array.from(byteArray);

				document.getElementById('outputBytes').value = JSON.stringify(byteValues);

				fetch('http://0.0.0.0:8090/image/upload', {
					method: 'POST',
					headers: {
						'Authorization': 'Bearer ' + token,
					},
					body: JSON.stringify({ raw_image_bytes: byteValues, image_format: String(format) })
				}).then(response => response.json())
					.then(data => console.log(data));
			};

			reader.readAsArrayBuffer(file);
		});
		</script>
	</body>

</html>
